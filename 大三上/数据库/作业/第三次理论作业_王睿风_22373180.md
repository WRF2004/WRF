### 第三次理论作业

1.试述 SQL 的特点

* **综合统一**：
  - SQL集数据定义语言（DDL）、数据操纵语言（DML）、数据控制语言（DCL）的功能于一体，能够完成数据库生命周期中的全部活动，包括关系模式的定义、修改、删除，数据的插入、查询和更新，数据库重构和维护，以及安全性、完整性和事务控制等。
* **高度非过程化**：
  - SQL是一种非过程化语言，用户只需指定操作目的，无需编写操作的具体步骤。数据库管理系统会自动选择最有效的执行路径，减轻了用户的负担，并提高了数据独立性。
* **面向集合的操作方式**：
  - SQL采用面向集合的操作方式，操作对象可以是元组的集合，不仅查询结果可以是多个记录的集合，插入、删除和更新操作也可以同时作用于多个记录。
* **多种使用方式**：
  - SQL既可以作为独立的语言在交互式环境中使用，也可以嵌入到高级语言程序中。在不同使用方式下，SQL的语法结构基本一致，提供了灵活性和方便性。
* **语言简洁、易学易用**：
  - SQL功能强大，但设计简洁，核心功能仅用少量动词即可实现，语法接近自然语言，易于学习和使用。



3.有两个关系 S(A, B,C, D)和 T(C,D,E,F)，写出与下列查询等价的 SQL 表达式:

(1) $\sigma_{A=10}(S)$的等价 SQL 表达式为: 

```
SELECT * FROM S WHERE A = 10;
```

(2) $\prod_{A,B}(S)$的等价 SQL 表达式为: 

```
SELECT A, B FROM S;
```

(3) $S\bowtie T$的等价 SQL 表达式为: 

```
SELECT * 
FROM S 
JOIN T;
```

(4) $S\underset{S.C=T.C}{\bowtie} T  $的等价 SQL 表达式为:

```
SELECT * 
FROM S 
JOIN T 
ON S.C = T.C;
```

(5) $S\underset{A<E}{\bowtie} T  $的等价 SQL 表达式为:

```
SELECT * 
FROM S 
JOIN T 
ON S.A < T.E;
```

(6) $ \prod_{C,D}(S)\times T$的等价 SQL 表达式为:

```
SELECT S.C, S.D, T.* 
FROM S, T;
```



4.用SQL语句建立第2章习题6中的4个表:针对建立的4个表用SQL完成第2章习题6中的查询。

建表语句

```
CREATE DATABASE SPJ;
USE SPJ;
CREATE TABLE S (
	SNO VARCHAR(20) PRIMARY KEY, 
    SNAME VARCHAR(20),
    STATUS INT,
    CITY VARCHAR(20)
);
CREATE TABLE P (
	PNO VARCHAR(20) PRIMARY KEY, 
    PNAME VARCHAR(20),
    COLOR VARCHAR(20),
    WEIGHT INT
);
CREATE TABLE J (
	JNO VARCHAR(20) PRIMARY KEY, 
    JNAME VARCHAR(20),
    CITY VARCHAR(20)
);
CREATE TABLE SPJ (
	SNO VARCHAR(20),
    PNO VARCHAR(20),
    JNO VARCHAR(20),
    QTY INT,
    PRIMARY KEY (SNO, PNO, JNO),
    FOREIGN KEY (SNO) REFERENCES S(SNO),  
    FOREIGN KEY (PNO) REFERENCES P(PNO),
    FOREIGN KEY (JNO) REFERENCES J(JNO)
);

INSERT INTO S (SNO, SNAME, STATUS, CITY)
VALUES
('S1', '精益', 20, '天津'),
('S2', '盛锡', 10, '北京'),
('S3', '东方红', 30, '北京'),
('S4', '丰泰盛', 20, '天津'),
('S5', '为民', 30, '上海');

INSERT INTO P (PNO, PNAME, COLOR, WEIGHT)
VALUES
('P1', '螺母', '红', 12),
('P2', '螺栓', '绿', 17),
('P3', '螺丝刀', '蓝', 14),
('P4', '螺丝刀', '红', 14),
('P5', '凸轮', '蓝', 40),
('P6', '齿轮', '红', 40);

INSERT INTO J (JNO, JNAME, CITY)
VALUES
('J1', '三建', '北京'),
('J2', '一汽', '长春'),
('J3', '弹簧厂', '天津'),
('J4', '造船厂', '天津'),
('J5', '机车厂', '唐山'),
('J6', '无线电厂', '常州'),
('J7', '半导体厂', '南京');

INSERT INTO SPJ (SNO, PNO, JNO, QTY)
VALUES
('S1', 'P1', 'J1', 200),
('S1', 'P1', 'J3', 100),
('S1', 'P1', 'J4', 700),
('S1', 'P2', 'J2', 100),
('S2', 'P3', 'J1', 400),
('S2', 'P3', 'J2', 200),
('S2', 'P3', 'J4', 500),
('S2', 'P3', 'J5', 400),
('S2', 'P5', 'J1', 400),
('S2', 'P5', 'J2', 100),
('S3', 'P1', 'J1', 200),
('S3', 'P3', 'J1', 200),
('S4', 'P5', 'J1', 100),
('S4', 'P6', 'J3', 300),
('S4', 'P6', 'J4', 200),
('S5', 'P2', 'J4', 100),
('S5', 'P3', 'J1', 200),
('S5', 'P6', 'J2', 200),
('S5', 'P6', 'J4', 500);
```

查询语句及其结果：

(1)求供应工程J1零件的供应商号码SNO:

```
SELECT DISTINCT SNO 
FROM SPJ
WHERE JNO='J1';
```

![4_1](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/4_1-1728813335134.png)

(2) 求供应工程J1零件P1的供应商号码SNO:

```
SELECT SNO 
FROM SPJ
WHERE JNO='J1'AND PNO='P1';
```

![4_2](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/4_2.png)

(3) 求供应工程J1零件为红色的供应商号码SNO:

```
SELECT SPJ.SNO 
FROM SPJ
JOIN P ON SPJ.PNO = P.PNO
WHERE SPJ.JNO = 'J1' AND P.COLOR = '红';
```

![4_3](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/4_3.png)

(4) 求没有使用天津供应商生产的红色零件的工程号JNO;

```
SELECT DISTINCT SPJ.JNO 
FROM SPJ
JOIN P ON SPJ.PNO = P.PNO
JOIN J ON SPJ.JNO = J.JNO
WHERE J.CITY != '天津' AND P.COLOR = '红';
```

![4_4](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/4_4-1728813243070.png)

(5) 求至少用了供应商S1所供应的全部零件的工程号JNO:

```
SELECT JNO
FROM SPJ
WHERE PNO IN (SELECT DISTINCT PNO FROM SPJ WHERE SNO = 'S1') AND SNO = 'S1' 
GROUP BY JNO
HAVING COUNT(DISTINCT PNO) = (SELECT COUNT(DISTINCT PNO) FROM SPJ WHERE SNO = 'S1');
```

![4_5](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/4_5-1728874873837.png)



5.针对习题4中的4个表试用 SQL完成以下各项操作:

(1)找出所有供应商的姓名和所在城市;

```
SELECT DISTINCT SNAME, CITY
FROM S;
```

![5_1](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/5_1.png)



(2)找出所有零件的名称、颜色、重量;

```
SELECT DISTINCT PNAME, COLOR, WEIGHT
FROM P;
```

![5_2](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/5_2.png)



(3)找出使用供应商S1所供应零件的工程号码;

```
SELECT DISTINCT JNO
FROM SPJ
WHERE SNO = 'S1';
```

![5_3](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/5_3.png)



(4)找出工程项目J2使用的各种零件的名称及其数量:

```
SELECT P.PNAME, SUM(SPJ.QTY)
FROM SPJ
JOIN P ON SPJ.PNO = P.PNO
WHERE SPJ.JNO = 'J2'
GROUP BY P.PNAME;
```

![5_4](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/5_4.png)



(5)找出上海厂商供应的所有零件号码:

```
SELECT DISTINCT SPJ.PNO
FROM SPJ
JOIN S ON S.SNO = SPJ.SNO
WHERE S.CITY = '上海';
```

![5_5](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/5_5.png)



(6)找出使用上海产的零件的工程名称;

```
SELECT DISTINCT J.JNAME
FROM J
JOIN SPJ ON J.JNO = SPJ.JNO
JOIN S ON SPJ.SNO = S.SNO
WHERE S.CITY = '上海';
```

![5_6](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/5_6.png)



(7)找出没有使用天津产的零件的工程号码;

```
SELECT JNO 
FROM J
WHERE J.JNO NOT IN(
	SELECT DISTINCT J.JNO
	FROM J
	JOIN SPJ ON J.JNO = SPJ.JNO
	JOIN S ON SPJ.SNO = S.SNO
	WHERE S.CITY = '天津'
);
```

![5_7](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/5_7.png)



(8)把全部红色零件的颜色改成蓝色:

```
UPDATE P 
SET COLOR = '蓝'
WHERE COLOR = '红' AND PNO IS NOT NULL;

SELECT * FROM P;
```

![5_8](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/5_8.png)



(9)由S5供给J4的零件P6改为由S3供应，请作必要的修改;

```
UPDATE spj
SET SNO = 'S3'
WHERE SNO = 'S5' AND PNO = 'P6' AND JNO = 'J4';

SELECT * FROM SPJ;
```

![5_9](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/5_9.png)



(10)从供应商关系中删除S2的记录，并从供应情况关系中删除相应的记录;

```
DELETE FROM SPJ
WHERE SPJ.SNO = 'S2';

DELETE FROM S
WHERE S.SNO = 'S2';

SELECT * FROM S;
SELECT * FROM SPJ;
```

![5_10](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/5_10.png)



(11)请将(S2,J6,P4,200)插入供应情况关系。

```
INSERT INTO SPJ (SNO, PNO, JNO, QTY)
VALUES
('S2','P4','J6',200);

SELECT * FROM SPJ;
```

![5_11](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/5_11.png)



9.请为三建工程项目建立一个供应情况的视图，包括供应商代码(SNO)、零件代码(PNO)、供应数量(QTY)。针对该视图完成下列查询:

为三建工程项目建立一个供应情况的视图:

```
CREATE VIEW 三建供应情况 AS
SELECT SNO, PNO, QTY
FROM SPJ
JOIN J ON J.JNO = SPJ.JNO
WHERE J.JNAME = '三建';
```

(1) 找出三建工程项目使用的各种零件代码及其数量:

```
SELECT PNO, SUM(QTY)
FROM 三建供应情况 
GROUP BY PNO;
```

![9_1](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/9_1.png)





(2) 找出供应商 S1 的供应情况。

```
SELECT *
FROM 三建供应情况 
WHERE SNO = 'S1';
```

![9_2](%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%90%86%E8%AE%BA%E4%BD%9C%E4%B8%9A_%E7%8E%8B%E7%9D%BF%E9%A3%8E_22373180.assets/9_2.png)